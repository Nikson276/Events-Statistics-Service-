---
title: "–ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Ç–µ—Å—Ç –ª–æ–≥ ‚Ññ1"
status: draft
version: 0.1
author: "–ú–∏—Ö–∞–π–ª–æ–≤ –ù–∏–∫–∏—Ç–∞"
date: 2025-12-09
tags: [k6, 3500VU, fail]
---

## üîß –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ **event-driven –ø–∞—Ç—Ç–µ—Ä–Ω—É** —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ –∏–Ω–≥–µ—Å—Ç, –±—Ä–æ–∫–µ—Ä–∏–∑–∞—Ü–∏—é –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ:

```
[ k6 / Client ]
       ‚Üì (HTTP)
[ nginx ] ‚Üí –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
       ‚Üì
[ FastAPI x3 ] ‚Üí 3 —Ä–µ–ø–ª–∏–∫–∏, 8 –≤–æ—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –∏–Ω—Å—Ç–∞–Ω—Å (8 —è–¥–µ—Ä CPU)
       ‚Üì (KafkaProducer) - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä (kafka-python)
[ Apache Kafka ] ‚Üí 3-–Ω–æ–¥–æ–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä –≤ KRaft-—Ä–µ–∂–∏–º–µ
       ‚Üì (KafkaConsumer)
[ ClickHouse ] ‚Üí 4-–Ω–æ–¥–æ–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä (—Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è, –±–µ–∑ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è)
```

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è / –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|----------|------------------------|-----------|
| **FastAPI** | Python 3.10, Uvicorn | `--workers 8`, –±–µ–∑ `flush()` –≤ Kafka |
| **Kafka** | `apache/kafka:3.7.0`, KRaft | –¢–æ–ø–∏–∫ `nikson-test`: 12 –ø–∞—Ä—Ç–∏—Ü–∏–π, `replication_factor=3`, `min.insync.replicas=2` |
| **ClickHouse** | `clickhouse/clickhouse-server:23` | –¢–∞–±–ª–∏—Ü–∞ `example.events` (MergeTree, –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü—É) |
| **Nginx** | `nginx:alpine` | Round-robin –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –º–µ–∂–¥—É 3 —Ä–µ–ø–ª–∏–∫–∞–º–∏ FastAPI |
| **Pyroscope** | `grafana/pyroscope:latest` | –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ CPU –∏ memory –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ |

## ESS —Ä–µ–≤—å—é –ø–æ—Å–ª–µ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ 3500 VU

### –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ —Ç–µ—Å—Ç–∞–º –≤ —ç—Ç–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
WARN[0210] Request Failed                                error="Post \"http://nginx:80/events/\": EOF"
WARN[0210] Request Failed                                error="Post \"http://nginx:80/events/\": read tcp 172.20.0.13:58998->172.20.0.14:80: read: connection reset by peer"
WARN[0210] Request Failed                                error="Post \"http://nginx:80/events/\": EOF"
WARN[0210] Request Failed                                error="Post \"http://nginx:80/events/\": EOF"
WARN[0210] Request Failed                                error="Post \"http://nginx:80/events/\": EOF"
WARN[0210] Request Failed                                error="Post \"http://nginx:80/events/\": EOF"


  ‚ñà THRESHOLDS 

    http_reqs
    ‚úì 'count>=3500' count=149558


  ‚ñà TOTAL RESULTS 

    checks_total.......: 149558 706.738608/s
    checks_succeeded...: 29.50% 44127 out of 149558
    checks_failed......: 70.49% 105431 out of 149558

    ‚úó status equals 200
      ‚Ü≥  29% ‚Äî ‚úì 44127 / ‚úó 105431

    HTTP
    http_req_duration..............: avg=661.63ms min=0s       med=11.81ms max=4.96s p(90)=2.46s p(95)=2.86s
      { expected_response:true }...: avg=2.19s    min=2.44ms   med=2.18s   max=4.96s p(90)=3.12s p(95)=3.37s
    http_req_failed................: 70.49% 105431 out of 149558
    http_reqs......................: 149558 706.738608/s

    EXECUTION
    iteration_duration.............: avg=2.71s    min=868.61¬µs med=2.47s   max=9.46s p(90)=4.75s p(95)=5.36s
    iterations.....................: 149558 706.738608/s
    vus............................: 60     min=11               max=3490
    vus_max........................: 3500   min=3500             max=3500

    NETWORK
    data_received..................: 7.6 MB 36 kB/s
    data_sent......................: 14 MB  68 kB/s




running (3m31.6s), 0000/3500 VUs, 149558 complete and 0 interrupted iterations
default ‚úì [======================================] 0000/3500 VUs  3m30s
```

#### üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (k6)

| –ù–∞–≥—Ä—É–∑–∫–∞ | RPS | –£—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã | –ú–µ–¥–∏–∞–Ω–∞ latency (—É—Å–ø–µ—Ö) | –û—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ |
|---------|-----|------------------|--------------------------|-----------------|
| **2500 VU** | 355 | 100% | 2.11 —Å | –ù–µ—Ç |
| **3500 VU** | 628‚Äì706 | ~29% | 2.46 —Å | `EOF`, `connection reset by peer` |

> ‚úÖ **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞**: **~350‚Äì400 RPS** (2500 VU)  
> ‚ö†Ô∏è **–ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏**: —Ä–µ–∑–∫–∏–π —Ä–æ—Å—Ç –æ—à–∏–±–æ–∫ –∏–∑-–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤ FastAPI –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –≤ Kafka.

### –í–æ–∑–≤—Ä–∞—Ç –∫ –æ–¥–Ω–æ–º—É FastAPI-–∏–Ω—Å—Ç–∞–Ω—Å—É. –ü–æ—á–µ–º—É —Ç–∞–∫ –ª—É—á—à–µ:

- **8 –≤–æ—Ä–∫–µ—Ä–æ–≤ Uvicorn –Ω–∞ 8 —è–¥—Ä–∞—Ö** ‚Äî —É–∂–µ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CPU**,
- **Nginx + 3 —Ä–µ–ø–ª–∏–∫–∏** ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç **–ª–∏—à–Ω–∏–π network hop** –∏ **–∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—é –∑–∞ —Ä–µ—Å—É—Ä—Å—ã** (–∫–æ–Ω—Ç–µ–∫—Å—Ç-—Å–≤–∏—á–∏, –∫—ç—à CPU),
- **–£–ø—Ä–æ—â–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** ‚Üí –º–µ–Ω—å—à–µ —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞, –ø—Ä–æ—â–µ –æ—Ç–ª–∞–¥–∫–∞ –∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ.

> üí° **–í—ã–≤–æ–¥**: –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ **–Ω–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ Kafka-–¥—Ä–∞–π–≤–µ—Ä–∞**. –ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å **–≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞**.

---

### **–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Kafka-–¥—Ä–∞–π–≤–µ—Ä ‚Äî –∫–ª—é—á–µ–≤–æ–π —à–∞–≥**

–°–µ–π—á–∞—Å —É –º–µ–Ω—è:

```python
# kafka-python + run_in_executor ‚Üí –°–ò–ù–•–†–û–ù–ù–´–ô –≤—ã–∑–æ–≤ –≤ –ø—É–ª–µ –ø–æ—Ç–æ–∫–æ–≤
await loop.run_in_executor(None, self.producer.send, ...)
```

üëâ –≠—Ç–æ **—Ä–∞–∑—Ä—É—à–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –ø—Ä–∏—Ä–æ–¥—É FastAPI**:

- Event loop **–∂–¥—ë—Ç**, –ø–æ–∫–∞ –ø–æ—Ç–æ–∫ –∑–∞–≤–µ—Ä—à–∏—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –≤ Kafka,
- –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ ‚Äî **–≤—Å–µ –≤–æ—Ä–∫–µ—Ä—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è**.

#### –†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **`aiokafka`**

**`aiokafka`** ‚Äî —ç—Ç–æ **–Ω–∞—Ç–∏–≤–Ω—ã–π async-–∫–ª–∏–µ–Ω—Ç –¥–ª—è Kafka**, –∫–æ—Ç–æ—Ä—ã–π:

- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å `async/await`,
- –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop,
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏—á–∏ Kafka (KRaft, —Å–∂–∞—Ç–∏–µ, –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∏ —Ç.–¥.).

### üìå –ò—Ç–æ–≥–æ–≤—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Å–¥–≤–∏–≥

| –ë—ã–ª–æ | –°—Ç–∞–Ω–µ—Ç |
|------|--------|
| 3√ó FastAPI + Nginx | **1√ó FastAPI (8 –≤–æ—Ä–∫–µ—Ä–æ–≤)** |
| `kafka-python` + `run_in_executor` | **`aiokafka` (–Ω–∞—Ç–∏–≤–Ω—ã–π async)** |
| –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ | **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å ‚Üí –Ω—É–ª–µ–≤–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** |
| –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ >400 RPS | **–¶–µ–ª—å: 1000+ RPS —Å <100 –º—Å latency** |

---

### üí™ –°–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è

1. –£–¥–∞–ª–∏ `nginx` –∏ `scale fastapi=3` –∏–∑ `docker-compose.yml`,
2. –£—Å—Ç–∞–Ω–æ–≤–∏ `aiokafka`,
3. –†–µ–∞–ª–∏–∑—É–π `AsyncKafkaProducerService`,
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç –Ω–∞ **2500 VU**.

## –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **ess/kafka_consumer/consumer.py**: –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ `aiokafka` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π.
   1. –í **ess/kafka_consumer/consumer.py._process_message**: –¥–æ–±–∞–≤–ª–µ–Ω –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ `API‚ÜíClickHouse latency`
2. **ess/app/services/kafka.py**: –í—ã–Ω–µ—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞—Ñ–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª producer, —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `aiokafka` –∏ —è–≤–ª—è–µ—Ç—Å—è singleton
   1. `send_and_wait()` ‚Äî –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏,
   2. `send()` ‚Äî –µ—Å–ª–∏ fire-and-forget.
3. **ess/app/main.py**: –Ω–æ–≤—ã–π –ø—Ä–æ–¥—é—Å–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ FastAPI (lifespan)
4. **ess/app/routers/events.py**: –æ–±–Ω–æ–≤–ª–µ–Ω—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
   1. **POST-—ç–Ω–¥–ø–æ–∏–Ω—Ç**: —Å—Ç–∞–ª `async` 
   2. **GET-—ç–Ω–¥–ø–æ–∏–Ω—Ç**: —Å—Ç–∞–ª `async` + `run_in_executor` –¥–ª—è ClickHouse.
5. **docker-compose**: –£–¥–∞–ª–∏–ª nginx service
6. **load-test.js**: –æ–±–Ω–æ–≤–∏–ª —Å–∫—Ä–∏–ø—Ç url –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤

–¢–µ–ø–µ—Ä—å  **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π pipeline**:

```bash
FastAPI (async) ‚Üí Kafka (aiokafka) ‚Üí Consumer (async) ‚Üí ClickHouse (run_in_executor)
```

## ESS –æ–±–∑–æ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è 3500 VU –ø–æ—Å–ª–µ –¥–æ—Ä–∞–±–æ—Ç–æ–∫

### –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ —Ç–µ—Å—Ç–∞–º 

```bash

         /\      Grafana   /‚Äæ‚Äæ/  
    /\  /  \     |\  __   /  /   
   /  \/    \    | |/ /  /   ‚Äæ‚Äæ\ 
  /          \   |   (  |  (‚Äæ)  |
 / __________ \  |_|\_\  \_____/ 

     execution: local
        script: /scripts/load-test.js
        output: -

     scenarios: (100.00%) 1 scenario, 3500 max VUs, 4m0s max duration (incl. graceful stop):
              * default: Up to 3500 looping VUs for 3m30s over 4 stages (gracefulRampDown: 30s, gracefulStop: 30s)



  ‚ñà THRESHOLDS 

    http_reqs
    ‚úì 'count>=3500' count=258287


  ‚ñà TOTAL RESULTS 

    checks_total.......: 258287  1216.541136/s
    checks_succeeded...: 100.00% 258287 out of 258287
    checks_failed......: 0.00%   0 out of 258287

    ‚úì status equals 200

    HTTP
    http_req_duration..............: avg=1.54s min=902.64¬µs med=1.42s max=32.23s p(90)=2.58s p(95)=3.03s
      { expected_response:true }...: avg=1.54s min=902.64¬µs med=1.42s max=32.23s p(90)=2.58s p(95)=3.03s
    http_req_failed................: 0.00%  0 out of 258287
    http_reqs......................: 258287 1216.541136/s

    EXECUTION
    iteration_duration.............: avg=1.57s min=1.05ms   med=1.44s max=32.31s p(90)=2.64s p(95)=3.11s
    iterations.....................: 258287 1216.541136/s
    vus............................: 1080   min=15          max=3492
    vus_max........................: 3500   min=3500        max=3500

    NETWORK
    data_received..................: 37 MB  175 kB/s
    data_sent......................: 63 MB  296 kB/s




running (3m32.3s), 0000/3500 VUs, 258287 complete and 0 interrupted iterations
default ‚úì [======================================] 0000/3500 VUs  3m30s
```

## üìä –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç: –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Ç–µ—Å—Ç 3500 VU (–≤–µ—Ä—Å–∏—è —Å `aiokafka`)

### ‚úÖ –ö–ª—é—á–µ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

- **–ù–∞–≥—Ä—É–∑–∫–∞**: –¥–æ **3500 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: **1216 RPS**
- **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**: **100% —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤** (0 –æ—à–∏–±–æ–∫)
- **–ú–µ–¥–∏–∞–Ω–∞ latency**: **1.42 —Å–µ–∫**
- **p(95) latency**: **3.03 —Å–µ–∫**

### üîç –ù–∞–±–ª—é–¥–µ–Ω–∏—è –∏–∑ consumer latency

- **–°–∫–≤–æ–∑–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (API ‚Üí ClickHouse)**:
    
    - –ù–∞ —Å—Ç–∞—Ä—Ç–µ: **~0.5 —Å–µ–∫**
    - –ù–∞ –ø–∏–∫–µ –Ω–∞–≥—Ä—É–∑–∫–∏: **–¥–æ 240 —Å–µ–∫**
    
- **–ü—Ä–∏—á–∏–Ω–∞ —Ä–æ—Å—Ç–∞**: ClickHouse –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å—Ç–∞–≤–∫–∏ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º RPS ‚Üí –æ—á–µ—Ä–µ–¥—å –≤ consumer —Ä–∞—Å—Ç—ë—Ç.

> üí° –≠—Ç–æ **—Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ consumer'–∞**, –Ω–æ **–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ HTTP-–æ—Ç–≤–µ—Ç** (FastAPI –æ—Ç–≤–µ—á–∞–µ—Ç —Å—Ä–∞–∑—É), —á—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å fire-and-forget –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

### üìå –í—ã–≤–æ–¥—ã

1. **FastAPI + aiokafka** ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç **>1200 RPS** —Å **–Ω—É–ª–µ–≤—ã–º —É—Ä–æ–≤–Ω–µ–º –æ—à–∏–±–æ–∫**.
2. **–£–∑–∫–æ–µ –º–µ—Å—Ç–æ —Å–º–µ—Å—Ç–∏–ª–æ—Å—å** —Å –∏–Ω–≥–µ—Å—Ç–∞ –Ω–∞ **consumer ‚Üí ClickHouse**.
3. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ **production-—ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏** –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ –¥–æ **1200 RPS** —Å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π latency.

### üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å consumer**: –±–∞—Ç—á-–≤—Å—Ç–∞–≤–∫–∏ –≤ ClickHouse, —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ consumer-–≤–æ—Ä–∫–µ—Ä–æ–≤.
- **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ lag'–∞**: –∞–ª–µ—Ä—Ç –ø—Ä–∏ —Ä–æ—Å—Ç–µ consumer lag > 60 —Å–µ–∫.
- **–î–ª—è —Ä–æ—Å—Ç–∞ RPS**: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å **ClickHouse** (–±–æ–ª—å—à–µ —Ä–µ–ø–ª–∏–∫, SSD, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ MergeTree).
